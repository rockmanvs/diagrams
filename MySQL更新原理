<mxfile host="app.diagrams.net" modified="2021-01-06T07:49:30.017Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36" etag="WH0pLjhm-HWUb6FN-ODh" version="13.10.6" type="github">
  <diagram id="DoIGknY1KvwOHWvYeFp_" name="第 1 页">
    <mxGraphModel dx="868" dy="1651" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="E-fpzYI40ZSotkjuiIgI-8" value="2、写入数据旧值，便于回滚" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-1" target="E-fpzYI40ZSotkjuiIgI-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-1" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="294" y="60" width="486" height="160" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-2" value="Innodb&lt;br&gt;存储引擎" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="450" y="70" width="57" height="20" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-35" value="&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 11px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255) ; display: inline ; float: none&quot;&gt;IO线程&lt;/span&gt;&lt;br style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 11px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px&quot;&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 11px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255) ; display: inline ; float: none&quot;&gt;随机刷盘&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.85;entryY=-0.05;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="E-fpzYI40ZSotkjuiIgI-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="410" y="200" as="sourcePoint" />
            <mxPoint x="409.96000000000004" y="340.02" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-3" value="pool buffer&lt;br&gt;缓冲池" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="160" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-15" value="&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-size: 11px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;helvetica&amp;#34; ; display: inline ; float: none&quot;&gt;1、请求更新数据&lt;br&gt;加载缓存数据&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="334" y="330" as="sourcePoint" />
            <mxPoint x="334" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-5" value="磁盘" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-7" value="undo日志" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="150" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-14" value="5、redo日志刷入磁盘" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-10" target="E-fpzYI40ZSotkjuiIgI-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-10" value="Redo log buffer" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="465.5" y="160" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-12" value="如果系统奔溃，Pool buffer,内存里的修改过的缓冲数据，以及Redo日志都会丢失" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-13" value="redo日志文件" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-16" target="E-fpzYI40ZSotkjuiIgI-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="458" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-16" value="select @innodb_flush_log_at_trx_commit;&lt;br&gt;redo日志的处理：&lt;br&gt;0：redo日志在缓冲中，不刷入磁盘&lt;br&gt;1：redo日志在提交事务成功时一起刷入磁盘中【建议使用】&lt;br&gt;2：redo日志写入os cache，让系统选择啥时候写入磁盘" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="375" y="540" width="330" height="90" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-19" value="&lt;span style=&quot;color: rgb(0 , 0 , 0) ; font-family: &amp;#34;helvetica&amp;#34; ; font-size: 11px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(255 , 255 , 255) ; display: inline ; float: none&quot;&gt;3、更新内存数据&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-18">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="370" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.945;entryY=0.25;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="532" y="-59" as="sourcePoint" />
            <mxPoint x="560" y="161" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-21" value="4、写入redo日志" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="E-fpzYI40ZSotkjuiIgI-20">
          <mxGeometry x="-0.0161" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-18" target="E-fpzYI40ZSotkjuiIgI-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-18" value="执行器" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="500.5" y="-90" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.629;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-22" target="E-fpzYI40ZSotkjuiIgI-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-22" value="binlog日志文件" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="630" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-23" target="E-fpzYI40ZSotkjuiIgI-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-23" value="6、准备提交事务，binlog写入磁盘" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="630" y="160" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-27" target="E-fpzYI40ZSotkjuiIgI-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-27" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;sync_binlog&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;0：binlog写入os cache&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;1：binlog写入磁盘&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="540" width="180" height="90" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.433;entryY=1.017;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="E-fpzYI40ZSotkjuiIgI-30" target="E-fpzYI40ZSotkjuiIgI-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-30" value="1、更新对应的binlog文件名称和更新的binlog日志在文件里的位置入写redo日志&lt;br&gt;2、写入commit标记" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="566" y="440" width="164" height="70" as="geometry" />
        </mxCell>
        <mxCell id="E-fpzYI40ZSotkjuiIgI-33" value="6、最后一步在redo日志中写入commit标记的意义是什么？&lt;br&gt;这时候肯定有同学会问了，最后在redo日志中写入commit标记有什么意义呢？&lt;br&gt;说白了，他其实是用来保持redo log日志与binlog日志一致的。&lt;br&gt;我们来举个例子，假设我们在提交事务的时候，一共有上图中的5、6、7三个步骤，必须是三个步骤都执行完毕，才算&lt;br&gt;是提交了事务。那么在我们刚完成步骤5的时候，也就是redo log刚刷入磁盘文件的时候，mysql宕机了，此时怎么&lt;br&gt;办？&lt;br&gt;这个时候因为没有最终的事务commit标记在redo日志里，所以此次事务可以判定为不成功。不会说redo日志文件里&lt;br&gt;有这次更新的日志，但是binlog日志文件里没有这次更新的日志，不会出现数据不一致的问题。&lt;br&gt;如果要是完成步骤6的时候，也就是binlog写入磁盘了，此时mysql宕机了，怎么办？&lt;br&gt;同理，因为没有redo log中的最终commit标记，因此此时事务提交也是失败的。&lt;br&gt;必须是在redo log中写入最终的事务commit标记了，然后此时事务提交成功，而且redo log里有本次更新对应的日&lt;br&gt;志，binlog里也有本次更新对应的日志 ，redo log和binlog完全是一致的。" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="210" y="680" width="630" height="200" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
